# Development Dockerfile
FROM openjdk:21-jdk-slim

# Set working directory
WORKDIR /app

# Install development tools and Maven
RUN apt-get update && apt-get install -y \
    maven \
    git \
    curl \
    vim \
    && rm -rf /var/lib/apt/lists/*

# Copy pom.xml first for better Docker layer caching
COPY pom.xml .

# Download dependencies
RUN mvn dependency:resolve dependency:resolve-sources

# Copy source code
COPY src ./src

# Expose application port and debug port
EXPOSE 8080 5005

# Set JVM options for development (including debug support)
ENV JAVA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=*:5005 -Dspring.profiles.active=dev"

# Use Maven to run the application in development mode
CMD ["mvn", "spring-boot:run", "-Dspring-boot.run.jvmArguments=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=*:5005"]